import express from "express";
import { connectToDb } from "./config/db.js";
import cors from 'cors'
import morgan from "morgan";
import dotenv from 'dotenv';

import userRoute from './routes/userRoute.js'

dotenv.config();
const app = express();

// middlewares
app.use(cors({
  credentials : true,
  // origin : 'exp://192.168.128.203:8081'
}));

// when the client sends json data, express.json() parses it, and populates in req.body
app.use(express.json());
// when the client sends form-url-encoded data, (express.urlencoded({extended : true}) parses it, and populates in req.body
app.use(express.urlencoded({extended : true}))
app.use(morgan('dev'));

// db connection
connectToDb();

app.get("/", (req, res) => {
  try {
    res.send("hello world");
  } catch (error) {
    console.log(error);
  }
});

// ROUTES : 
app.use('/api/v1/auth', userRoute)

// this is the error handling middleware , it will we executed when we call next(err)
app.use((err,req,res,next) => {
    console.log('Error occured'.bgRed);
    console.log(err.message);
    
    console.log(`${err}`.red);

    res.status(err.status).json({
        error : true,
        body : err
    })
})

// connecting to the server
const server = app.listen(process.env.PORT, () => {
  console.log(`Server started at port ${process.env.PORT}`.bgGreen);
});
